<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>CI360 - Teste Oficial</title>

  <style>
    body { font-family: Arial; padding: 30px; }
    .box { max-width: 700px; border:1px solid #ddd; padding:20px; border-radius:10px; }
    input { padding:10px; width:260px; }
    button { padding:10px 14px; margin-top:10px; margin-right:10px; }
    .log { background:#0b1020; color:#d6e1ff; padding:12px; border-radius:10px; margin-top:15px; }
    .ok { color:green; font-weight:bold; }
    .bad { color:red; font-weight:bold; }
  </style>

  <script>
    const TENANT_ID = "6b615c4d3c00016d3d12ce8f";
    const EVENT_KEY = "teste_sdk_ci360";

    // Stub CI360
    (function(ci,a){
      window[ci]||(function(){
        var ef=window[ci]=function(){return ef.q.push(arguments)};
        ef.q=[];ef.a=a||{}
      })()
    })("ci360",{tenantId:TENANT_ID});

    // OT2
    (function(){
      var s=document.createElement("script");
      s.async=true;
      s.src="https://i-us.ci360.marketing/js/ot2.min.js";
      document.head.appendChild(s);
    })();

    // Identity vars
    function setIdentity(id){
      window.ci360_identity=id;
      window.cktlg_identity=id;
      localStorage.setItem("ci360_customer_id",id);
    }

    function sendEvent(){
      ci360("event",{name:EVENT_KEY});
    }
  </script>
</head>

<body>

<div class="box">

  <h2>CI360 – Teste oficial de Web Event</h2>

  <p>Identity atual: <b id="identityView">(não definida)</b></p>

  <input id="identityInput" placeholder="RENAN_TESTE_001">

  <br>

  <button onclick="handleIdentity()">Set Identity</button>
  <button id="btn-ci360-click">Disparar evento</button>

  <p id="status" class="bad">Aguardando SDK...</p>

  <div class="log" id="log"></div>

</div>

<script>

const log = (msg)=>{
  document.getElementById("log").innerHTML =
    "["+new Date().toLocaleTimeString()+"] "+msg+"<br>"
    + document.getElementById("log").innerHTML;
};

function sdkReady(){
  return typeof window.Sci360 === "object";
}

function updateStatus(){
  if(sdkReady()){
    status.innerHTML="SDK carregado";
    status.className="ok";
  }else{
    status.innerHTML="Aguardando SDK...";
    status.className="bad";
  }
}

function handleIdentity(){
  const id = identityInput.value || "RENAN_TESTE_001";
  setIdentity(id);
  identityView.innerText=id;
  log("Identity definida: "+id);

  ci360("event",{name:EVENT_KEY}); // flush
}

document.getElementById("btn-ci360-click")
  .addEventListener("click",()=>{
    log("Click enviado");
    sendEvent();
  });

setInterval(updateStatus,800);

</script>

</body>
</html>
