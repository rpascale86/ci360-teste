<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CI360 - Projeto de Teste</title>

  <!-- 1) Stub CI360 -->
  <script>
    (function(ci, a) {
      window[ci] || (function() {
        var ef = window[ci] = function() { return ef.q.push(arguments); };
        ef.q = [];
        ef.a = a || {};
      })();
    })('ci360', {
      tenantId: '6b615c4d3c00016d3d12ce8f'
    });
  </script>

  <!-- 2) SDK oficial -->
  <script async
    data-efname="ci360"
    src="https://i-us.ci360.marketing/js/ot2.min.js"
    id="ob-script-async">
  </script>

  <style>
    body { font-family: Arial, Helvetica, sans-serif; padding: 32px; line-height: 1.4; }
    .card { max-width: 900px; border: 1px solid #ddd; border-radius: 12px; padding: 18px 18px 8px; }
    h1 { margin: 0 0 8px; font-size: 24px; }
    p { margin: 10px 0; }
    button { padding: 10px 14px; font-size: 15px; border-radius: 10px; border: 1px solid #333; cursor: pointer; margin-right: 10px; margin-bottom: 10px; }
    code { background: #f6f6f6; padding: 2px 6px; border-radius: 6px; }
    .muted { color: #666; font-size: 13px; }
    .ok { color: #0b8f2f; font-weight: 700; }
    .bad { color: #b00020; font-weight: 700; }
    .log { background: #0b1020; color: #d6e1ff; padding: 12px; border-radius: 12px; min-height: 140px; white-space: pre-wrap; }
    .row { display: flex; gap: 14px; flex-wrap: wrap; align-items: center; }
  </style>
</head>

<body>
  <div class="card">
    <h1>CI360 â€“ Projeto simples de teste</h1>

    <p>
      Use esta pÃ¡gina para validar rapidamente a <b>Tag/SDK Web do CI360</b>.
    </p>

    <p>
      <b>Evento principal (API event key no CI360):</b>
      <code id="eventNameUi"></code>
    </p>

    <div class="row">
      <button id="btn-ci360-evento-basico" onclick="enviarEventoBasico()">Enviar evento bÃ¡sico</button>
      <button id="btn-ci360-evento-atributo" onclick="enviarEventoComAtributo()">Enviar evento + atributo</button>
      <button onclick="enviarIdentityTeste()">Enviar identity (teste)</button>
      <button onclick="testarCarregamento()">Testar se SDK carregou</button>
      <span id="status" class="bad">Status: aguardando SDK...</span>
    </div>

    <p class="muted">
      ValidaÃ§Ã£o: DevTools â†’ Network â†’ filtrar por <code>/t/s/</code>.
    </p>

    <p><b>Log:</b></p>
    <div id="log" class="log"></div>
  </div>

  <script>

    // ðŸ”¹ EVENTO configurado no CI360
    const EVENT_NAME = "teste_sdk_ci360";

    document.getElementById("eventNameUi").textContent = EVENT_NAME;

    const STATUS_EL = () => document.getElementById("status");

    function log(msg) {
      const el = document.getElementById("log");
      const now = new Date().toLocaleString();
      el.textContent = `[${now}] ${msg}\n` + el.textContent;
    }

    function sdkDisponivel() {
      return typeof window.ci360 === "function";
    }

    function aguardarSdk(timeoutMs = 10000) {
      const started = Date.now();
      return new Promise((resolve, reject) => {
        const t = setInterval(() => {
          if (sdkDisponivel()) {
            clearInterval(t);
            resolve(true);
          } else if (Date.now() - started > timeoutMs) {
            clearInterval(t);
            reject();
          }
        }, 200);
      });
    }

    async function testarCarregamento() {
      try {
        await aguardarSdk();
        STATUS_EL().className = "ok";
        STATUS_EL().textContent = "Status: SDK carregado âœ…";
        log("CI360 disponÃ­vel.");
      } catch {
        STATUS_EL().className = "bad";
        STATUS_EL().textContent = "SDK NÃƒO carregou âŒ";
        log("SDK nÃ£o carregou.");
      }
    }

    // ðŸ”¹ EVENTO SIMPLES
    function enviarEventoBasico() {
      if (!sdkDisponivel()) return alert("SDK nÃ£o carregado");

      window.ci360("event", {
        name: EVENT_NAME
      });

      log("Evento bÃ¡sico enviado.");
    }

    // ðŸ”¹ EVENTO COM ATRIBUTOS
    function enviarEventoComAtributo() {
      if (!sdkDisponivel()) return alert("SDK nÃ£o carregado");

      window.ci360("event", {
        name: EVENT_NAME,
        attributes: {
          customName: "teste_botao",
          customGroupName: "grupo_teste"
        }
      });

      log("Evento com atributos enviado.");
    }

    // ðŸ”¹ IDENTITY (novo visitante CI360)
    function enviarIdentityTeste() {
      if (!sdkDisponivel()) return alert("SDK nÃ£o carregado");

      const TEST_ID = "RENAN_TESTE_001";

      window.ci360("identity", {
        type: "customer_id",
        value: TEST_ID
      });

      log(`Identity enviada: ${TEST_ID}`);

      // dispara evento logo depois
      window.ci360("event", { name: EVENT_NAME });

      log("Evento enviado apÃ³s identity.");
    }

    // ðŸ”¹ Auto-check
    (async () => {
      log("PÃ¡gina carregada. Aguardando CI360...");
      try {
        await aguardarSdk(8000);
        STATUS_EL().className = "ok";
        STATUS_EL().textContent = "Status: SDK carregado âœ…";
        log("CI360 pronto automaticamente.");
      } catch {
        log("SDK ainda nÃ£o detectado.");
      }
    })();

  </script>
</body>
</html>
